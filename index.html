<!DOCTYPE html>
<html lang="ko">
<head>

  <link rel="icon" href="image.png" type="image/png">
  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <title>TXT 런처</title>
  <meta name="theme-color" content="#69b10d">
  <style>
    :root { --accent:#69b10d; --card:#fff; --bg:#f8fafc; --border:#e5e7eb; }
    *{ box-sizing:border-box }
    body{ margin:0; font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:var(--bg); color:#0f172a;}
    header{ position:sticky; top:0; background:#fff; border-bottom:1px solid var(--border); padding:12px 16px; display:flex; gap:12px; align-items:center; z-index:10;}
    h1{ margin:0; font-size:18px; font-weight:800;}
    .repo{ font-size:12px; color:#475569 }
    .search{ margin-left:auto; display:flex; gap:8px; align-items:center;}
    .search input{ height:36px; padding:0 10px; border:1px solid var(--border); border-radius:10px; width:200px; }
    main{ padding:14px; max-width:880px; margin:0 auto; }
    .list{ display:grid; grid-template-columns: repeat(auto-fill,minmax(260px,1fr)); gap:12px;}
    .card{ background:var(--card); border:1px solid var(--border); border-radius:14px; padding:12px; display:flex; flex-direction:column; gap:10px; }
    .name{ font-weight:800; font-size:14px; word-break:break-all;}
    .meta{ font-size:12px; color:#64748b; display:flex; gap:8px; flex-wrap:wrap;}
    .btns{ display:flex; gap:8px; flex-wrap:wrap;}
    .btn{ border:1px solid var(--border); background:#fff; border-radius:10px; padding:8px 10px; font-weight:700; font-size:13px; cursor:pointer; }
    .btn.primary{ background:var(--accent); color:#fff; border-color:transparent; }
    .preview{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; line-height:1.45; color:#111827; background:#f1f5f9; border:1px dashed #cbd5e1; border-radius:10px; padding:10px; max-height:160px; overflow:auto; white-space:pre-wrap; }
    .empty, .error{ text-align:center; color:#475569; margin-top:32px; }
    footer{ padding:20px; text-align:center; color:#94a3b8; font-size:12px;}
  </style>
</head>
<body>
  <header>
    <h1>📁 TXT 런처</h1>
    <div class="repo" id="repoLabel"></div>
    <div class="search">
      <input id="q" type="search" placeholder="파일 검색…" />
      <button class="btn" id="refreshBtn">새로고침</button>
    </div>
  </header>

  <main>
    <div id="list" class="list" aria-live="polite"></div>
    <div id="empty" class="empty" style="display:none;">표시할 txt 파일이 없어요.</div>
    <div id="err" class="error" style="display:none;"></div>
  </main>

  <footer>자동 목록 갱신 · GitHub Contents API 사용</footer>

<script>
/** =============== 설정 =============== **/
const OWNER  = "hodewdew-creator";
const REPO   = "ZHYUNK";
const BRANCH = "main"; // 기본 브랜치
const DIR    = "";     // 루트에서 txt만 가져오기

/** =============== 내부 로직 =============== **/
const apiBase = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${encodeURIComponent(DIR)}?ref=${encodeURIComponent(BRANCH)}`;
const repoLabel = document.getElementById('repoLabel');
repoLabel.textContent = `${OWNER}/${REPO}@${BRANCH}${DIR ? " / "+DIR : ""}`;

const $list = document.getElementById('list');
const $empty = document.getElementById('empty');
const $err = document.getElementById('err');
const $q = document.getElementById('q');
const $refresh = document.getElementById('refreshBtn');

let allFiles = [];

async function fetchTxtList(){
  $err.style.display = "none";
  $empty.style.display = "none";
  $list.innerHTML = "";
  try{
    const res = await fetch(apiBase, { headers: { "Accept": "application/vnd.github+json" }});
    if(!res.ok){
      const text = await res.text();
      throw new Error(`API ${res.status}: ${text}`);
    }
    const data = await res.json();
    const items = Array.isArray(data) ? data : [data];
    const txts = items.filter(x => x.type === "file" && x.name.toLowerCase().endsWith(".txt"));

    txts.sort((a,b)=> a.name.localeCompare(b.name, 'ko'));
    allFiles = txts;
    render(txts);
  }catch(e){
    console.error(e);
    $err.textContent = "불러오기에 실패했어요. (깃허브 API 제한이거나 설정값이 잘못됨)";
    $err.style.display = "block";
  }
}

function render(files){
  $list.innerHTML = "";
  if(files.length === 0){
    $empty.style.display = "block";
    return;
  }
  files.forEach(f => {
    const card = document.createElement('div');
    card.className = "card";

    const name = document.createElement('div');
    name.className = "name";
    name.textContent = f.name;

    const meta = document.createElement('div');
    meta.className = "meta";
    meta.innerHTML = `
      <span>size: ${formatSize(f.size)}</span>
      <span>path: ${f.path}</span>
    `;

    const btns = document.createElement('div');
    btns.className = "btns";
    const rawUrl = f.download_url || rawUrlFromPath(f.path);
    const viewBtn = btn("보기", "primary", async () => {
      const text = await fetchText(rawUrl);
      pre.textContent = firstLines(text, 2000);
    });
    const rawBtn = linkBtn("원본 열기", rawUrl);
    const ghBtn  = linkBtn("GitHub 보기", f.html_url);

    btns.append(viewBtn, rawBtn, ghBtn);

    const pre = document.createElement('pre');
    pre.className = "preview";
    pre.textContent = "미리보기를 누르면 내용이 보여요.";

    card.append(name, meta, btns, pre);
    $list.appendChild(card);
  });
}

function btn(label, cls, onClick){
  const b = document.createElement('button');
  b.className = `btn ${cls||""}`;
  b.textContent = label;
  b.onclick = onClick;
  return b;
}
function linkBtn(label, href){
  const a = document.createElement('a');
  a.className = "btn";
  a.textContent = label;
  a.href = href;
  a.target = "_blank";
  a.rel = "noopener noreferrer";
  return a;
}
async function fetchText(url){
  const res = await fetch(url);
  if(!res.ok) throw new Error("raw fetch error");
  return await res.text();
}
function firstLines(str, maxChars){
  return (str.length > maxChars) ? str.slice(0,maxChars) + "\n…(이하 생략)" : str;
}
function formatSize(n){
  if(n < 1024) return n + " B";
  if(n < 1024*1024) return (n/1024).toFixed(1) + " KB";
  return (n/1024/1024).toFixed(1) + " MB";
}
function rawUrlFromPath(path){
  return `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/${encodeURIComponent(path).replace(/%2F/g,'/')}`;
}

$q.addEventListener('input', ()=>{
  const q = $q.value.trim().toLowerCase();
  if(!q){ render(allFiles); return; }
  render(allFiles.filter(f => f.name.toLowerCase().includes(q) || f.path.toLowerCase().includes(q)));
});

$refresh.addEventListener('click', fetchTxtList);

fetchTxtList();
</script>
</body>
</html>
